<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ - Ù…Ø®ÙŠÙ… Ù…ÙƒØ§Ù†</title>
  <!-- Firebase SDK (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª!) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: #0d1b2a;
      position: relative;
      padding: 0;
      margin: 0;
      direction: rtl;
      color: #fff;
      min-height: 100vh;
    }

    #canvas-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    .container {
      width: 95%;
      max-width: 600px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.25);
      position: relative;
      z-index: 2;
      margin-top: 20px;
      margin-bottom: 30px;
      color: #000;
    }

    #logo {
      text-align: center;
      padding: 15px 0;
    }

    #logo img {
      width: auto;
      max-width: 160px;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #000;
      font-size: 24px;
      font-weight: bold;
      line-height: 1.3;
    }

    .container p {
      text-align: center;
      margin-bottom: 20px;
      color: #000;
      font-size: 16px;
      line-height: 1.4;
    }

    .form-group {
      margin-bottom: 18px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
      color: #000;
      font-size: 15px;
    }
    input, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #999;
      border-radius: 8px;
      font-size: 16px;
      background: #fff;
      color: #000;
    }
    button {
      width: 100%;
      padding: 14px;
      background: #000;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 17px;
      cursor: pointer;
      transition: background 0.3s;
      font-weight: bold;
    }
    button:hover {
      background: #333;
    }
    .error {
      color: #d32f2f;
      font-size: 14px;
      margin-top: 5px;
    }
    .info {
      background: #f0f0f0;
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
      font-size: 14px;
      color: #000;
      border: 1px solid #ddd;
    }
    .loading {
      text-align: center;
      color: #000;
      font-style: italic;
      font-size: 15px;
    }

    .qr-section {
      text-align: center;
      margin-top: 25px;
      color: #000;
    }
    .qr-section button {
      background: #2c5e3e;
      color: white;
      padding: 11px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    #qrCode {
      margin-top: 15px;
    }

    @media (max-width: 480px) {
      .container { padding: 20px; margin-top: 10px; }
      h1 { font-size: 22px; }
      input, select, button { font-size: 17px; }
    }
    @media (min-width: 768px) {
      .container { padding: 30px; margin-top: 30px; }
      h1 { font-size: 28px; }
    }
  </style>
</head>
<body>

  <canvas id="canvas-bg"></canvas>

  <div class="container">
    <div id="logo">
      <!-- âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø³Ø§ÙØ© Ø²Ø§Ø¦Ø¯Ø© Ù‚Ø¨Ù„ "=" -->
      <img src="c:\Users\AMT\Downloads\IMG_3513.jpg" alt="Ù„ÙˆØ¬Ùˆ Ù…Ø®ÙŠÙ… Ù…ÙƒØ§Ù†">
    </div>

    <h1>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ ÙÙŠ Ù…Ø®ÙŠÙ… "Ù…ÙƒØ§Ù†"</h1>
    <p>
      âš ï¸ ÙŠÙØ³Ù…Ø­ Ø¨Ø­Ø¬Ø² <strong>Ø´Ø®Øµ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ù„ÙƒÙ„ ØªØ§Ø±ÙŠØ®</strong>
    </p>

    <form id="bookingForm">
      <div class="form-group">
        <label for="fullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
        <input type="text" id="fullName" name="fullName" required />
        <div class="error" id="fullNameError"></div>
      </div>

      <div class="form-group">
        <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ :</label>
        <input type="tel" id="phone" name="phone" required placeholder="91234567 Ø£Ùˆ 78901234" />
        <div class="error" id="phoneError"></div>
      </div>

      <div class="form-group">
        <label for="location">Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ù…Ù†Ø·Ù‚Ø©):</label>
        <input type="text" id="location" name="location" required />
        <div class="error" id="locationError"></div>
      </div>

      <div class="form-group">
        <label for="date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²:</label>
        <input type="date" id="date" name="date" required />
        <div class="info" id="dateStatus">Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®Ù‹Ø§ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙØ±</div>
        <div class="error" id="dateError"></div>
      </div>

      <div class="form-group">
        <label for="timeSlot">Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©:</label>
        <select id="timeSlot" name="timeSlot" required>
          <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©</option>
          <option value="Ø§Ù„ØµØ¨Ø§Ø­ (7:00 Øµ - 12:00 Ø¸)">Ø§Ù„ØµØ¨Ø§Ø­ (7:00  - 12:00 )</option>
          <option value="Ø§Ù„Ù…Ø³Ø§Ø¡ (4:00 Ù… - 12:00 Øµ)">Ø§Ù„Ù…Ø³Ø§Ø¡ (4:00  - 12:00 )</option>
        </select>
        <div class="error" id="timeError"></div>
      </div>

      <button type="submit" id="submitBtn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</button>
      <div class="loading" id="loading" style="display:none;">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙØ±...</div>
    </form>

    <div class="qr-section">
      <button onclick="showQR()">ğŸ“² Ø´Ø§Ø±Ùƒ Ø¹Ø¨Ø± Ø±Ù…Ø² QR</button>
      <div id="qrCode"></div>
    </div>
  </div>

  <!-- Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
  <script>
    const canvas = document.getElementById('canvas-bg');
    const ctx = canvas.getContext('2d');
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();

    const particles = [];
    const particleCount = window.innerWidth < 768 ? 40 : 80;

    class Particle {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 1.8 + 0.3;
        this.speedX = Math.random() * 0.8 - 0.4;
        this.speedY = Math.random() * 0.8 - 0.4;
        this.color = `rgba(255, 255, 255, ${Math.random() * 0.5 + 0.2})`;
      }
      update() {
        this.x += this.speedX;
        this.y += this.speedY;
        if (this.x > canvas.width || this.x < 0) this.speedX *= -1;
        if (this.y > canvas.height || this.y < 0) this.speedY *= -1;
      }
      draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    for (let i = 0; i < particleCount; i++) {
      particles.push(new Particle());
    }

    function animate() {
      ctx.fillStyle = 'rgba(13, 27, 42, 0.12)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < particles.length; i++) {
        particles[i].update();
        particles[i].draw();
      }
      requestAnimationFrame(animate);
    }
    animate();

    window.addEventListener('resize', resizeCanvas);
  </script>

  <!-- QR Code (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª!) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    function showQR() {
      const url = window.location.href;
      const qrContainer = document.getElementById('qrCode');
      qrContainer.innerHTML = '';
      new QRCode(qrContainer, {
        text: url,
        width: 150,
        height: 150,
        colorDark: '#000',
        colorLight: '#fff'
      });
    }
  </script>

  <!-- Firebase + Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø¬Ø² -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAwudkdBX1Ad7e27WnPzUzNYr5Ba9vuBQQ",
      authDomain: "mukhayam-makan.firebaseapp.com",
      projectId: "mukhayam-makan",
      storageBucket: "mukhayam-makan.firebasestorage.app",
      messagingSenderId: "847036539994",
      appId: "1:847036539994:web:5edf07b5cbc3e7fe5f2463",
      measurementId: "G-WLZF8Z9BPB"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    document.getElementById('date').min = new Date().toISOString().split('T')[0];

    document.getElementById('date').addEventListener('change', async function() {
      const date = this.value;
      const statusEl = document.getElementById('dateStatus');
      if (!date) {
        statusEl.textContent = 'Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®Ù‹Ø§ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙØ±';
        statusEl.style.backgroundColor = '#f0f0f0';
        statusEl.style.color = '#000';
        return;
      }
      document.getElementById('loading').style.display = 'block';
      const doc = await db.collection('bookings').doc(date).get();
      document.getElementById('loading').style.display = 'none';
      if (doc.exists) {
        statusEl.textContent = 'âŒ Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø­Ø¬ÙˆØ² Ø¨Ø§Ù„ÙØ¹Ù„!';
        statusEl.style.backgroundColor = '#ffebee';
        statusEl.style.color = '#000';
      } else {
        statusEl.textContent = 'âœ… Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…ØªØ§Ø­ Ù„Ù„Ø­Ø¬Ø²';
        statusEl.style.backgroundColor = '#e8f5e9';
        statusEl.style.color = '#000';
      }
    });

    document.getElementById('bookingForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      document.querySelectorAll('.error').forEach(el => el.textContent = '');

      const name = document.getElementById('fullName').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const location = document.getElementById('location').value.trim();
      const date = document.getElementById('date').value;
      const timeSlot = document.getElementById('timeSlot').value;

      let valid = true;
      if (!name) { document.getElementById('fullNameError').textContent = 'Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨'; valid = false; }
      if (!phone || !/^[79]\d{7}$/.test(phone)) {
        document.getElementById('phoneError').textContent = 'Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­ (ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 9 Ø£Ùˆ 7 Ùˆ8 Ø£Ø±Ù‚Ø§Ù…)';
        valid = false;
      }
      if (!location) { document.getElementById('locationError').textContent = 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø·Ù„ÙˆØ¨'; valid = false; }
      if (!date) { document.getElementById('dateError').textContent = 'Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®Ù‹Ø§'; valid = false; }
      if (!timeSlot) { document.getElementById('timeError').textContent = 'Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©'; valid = false; }

      if (!valid) return;

      const docRef = db.collection('bookings').doc(date);
      const docSnap = await docRef.get();
      if (docSnap.exists) {
        alert('âŒ ØªÙ… Ø­Ø¬Ø² Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„ØªÙˆÙ‡! Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®Ù‹Ø§ Ø¢Ø®Ø±.');
        return;
      }

      // === âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø¥Ù„ØºØ§Ø¡ ÙØ±ÙŠØ¯ ===
      const cancelCode = Math.random().toString(36).substring(2, 10);

      await docRef.set({
        fullName: name,
        phone: phone,
        location: location,
        time: timeSlot,
        cancelCode: cancelCode,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      // === âœ… Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ù„ØºØ§Ø¡ (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª!) ===
      const YOUR_SITE_URL = "https://mukhayam-makan.web.app"; // â† ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø§ÙØ§Øª!
      const cancelUrl = `${YOUR_SITE_URL}/cancel.html?code=${cancelCode}`;

      const message = `Ù…Ø±Ø­Ø¨Ø§Ù‹! ${name}\nâœ… ØªÙ… Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ ÙÙŠ Ù…Ø®ÙŠÙ… "Ù…ÙƒØ§Ù†"!\nğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}\nâ° Ø§Ù„ÙØªØ±Ø©: ${timeSlot}\nğŸ“± Ø§Ù„Ø¬ÙˆØ§Ù„: ${phone}\nğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${location}\n\nâŒ Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²ØŒ Ø§Ø¶ØºØ· Ù‡Ù†Ø§:\n${cancelUrl}`;
      const encodedMessage = encodeURIComponent(message);
      const campWhatsApp = '96878421613';
      // === âœ… Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ ØµØ­ÙŠØ­ (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª!) ===
      window.open(`https://wa.me/${campWhatsApp}?text=${encodedMessage}`, '_blank');

      this.reset();
      document.getElementById('dateStatus').textContent = 'Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®Ù‹Ø§ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙØ±';
      document.getElementById('dateStatus').style.backgroundColor = '#f0f0f0';
      document.getElementById('dateStatus').style.color = '#000';
    });
  </script>
</body>
</html>